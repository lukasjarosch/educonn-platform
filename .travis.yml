language: go

services:
  - docker

go:
  - "1.10"

before_install:

jobs:
  include:
    - stage: build
      script:
        - bash bin/install-protobuf.sh
        - go get -u github.com/golang/dep/cmd/dep
        - go get -u github.com/golang/protobuf/protoc-gen-go
        - go get -u github.com/micro/protoc-gen-micro
        - export PATH=$PATH:$HOME/protobuf/bin
        - dep ensure -v
        - make proto
        - make all

    - stage: docker
      script:
        - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME"
        - make docker
        - make docker-push-dev

